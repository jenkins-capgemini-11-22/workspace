pipeline {
    agent any
    stages {
        stage('build') {
            steps {
                script {
                    if (isUnix()) {
                        sh script: 'sleep 14', label: 'build'
                        sh script: 'sleep 1', label: 'publish test results'
                        sh script: 'sleep 3', label: 'create & publish Docker image'
                        sh script: 'sleep 1', label: 'publish documentation'
                    } else {
                        bat 'timeout 14'
                        bat 'timeout 1'
                        bat 'timeout 3'
                        bat 'timeout 1'
                    }
                }
            }
        }
        stage('quality gates') {
            parallel {
                stage('static analysis') {
                    steps {
                        script {
                            if (isUnix()) {
                                sh script: 'sleep 3', label: 'run static analysis'
                            } else {
                                bat 'timeout 3'
                            }
                        }
                    }
                }
                stage('security scanning') {
                    steps {
                        script {
                            if (isUnix()) {
                                sh script: 'sleep 12', label: 'run security scan'
                            } else {
                                bat 'timeout 12'
                            }
                        }
                    }
                }
                stage('Docker image scanning') {
                    steps {
                        script {
                            if (isUnix()) {
                                sh script: 'sleep 6', label: 'run Docker image scan'
                            } else {
                                bat 'timeout 6'
                            }
                        }
                    }
                }
            }
        }
        stage('deploy to dev environment') {
            steps {
                script {
                    if (isUnix()) {
                        sh script: 'sleep 2', label: 'deploy to dev'
                    } else {
                        bat 'timeout 2'
                    }
                }
            }
        }
        stage('smoke tests dev') {
            steps {
                script {
                    if (isUnix()) {
                        sh script: 'sleep 3', label: 'run smoke tests'
                    } else {
                        bat 'timeout 3'
                    }
                }
            }
        }
        stage('regression tests') {
            steps {
                script {
                    if (isUnix()) {
                        sh script: 'sleep 12', label: 'run regression tests'
                    } else {
                        bat script: 'timeout 12', label: 'run regression tests'
                    }
                }
            }
        }
        stage('acceptance tests') {
            steps {
                script {
                    if (isUnix()) {
                        sh script: 'sleep 24', label: 'run acceptance tests'
                    } else {
                        bat 'timeout 24'
                    }
                }
            }
        }
        stage('performance tests') {
            steps {
                script {
                    if (isUnix()) {
                        sh script: 'sleep 54', label: 'run performance tests'
                    } else {
                        bat 'timeout 54'
                    }
                }
            }
        }
        stage('deploy to staging') {
            steps {
                script {
                    if (isUnix()) {
                        sh script: 'sleep 2', label: 'deploy to stage'
                    } else {
                        bat 'timeout 2'
                    }
                }
            }
        }
        stage('smoke tests stage') {
            steps {
                script {
                    if (isUnix()) {
                        sh script: 'sleep 3', label: 'run smoke tests'
                    } else {
                        bat 'timeout 3'
                    }
                }
            }
        }
        stage('deploy to production') {
            steps {
                script {
                    if (isUnix()) {
                        sh script: 'sleep 2', label: 'deploy to prod'
                    } else {
                        bat 'timeout 2'
                    }
                }
            }
        }
        stage('smoke tests production') {
            steps {
                script {
                    if (isUnix()) {
                        sh script: 'sleep 3', label: 'run smoke tests'
                    } else {
                        bat 'timeout 3'
                    }
                }
            }
        }
        stage('synthetic tests') {
            steps {
                script {
                    if (isUnix()) {
                        sh script: 'sleep 5', label: 'run synthetic tests'
                    } else {
                        bat 'timeout 5'
                    }
                }
            }
        }
    }
}
